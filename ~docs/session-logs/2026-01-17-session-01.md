# DiztinGUIsh Session Log - 2026-01-17 Session 01

## Session Summary
CDL/DIZ export integration - implemented exporters for Peony consumption.

## Work Completed

### Research
- Analyzed DiztinGUIsh codebase structure:
	- `Diz.Core.Interfaces/Enums.cs` - FlagType enum (0x00-0x60 values)
	- `Diz.Core/model/ROMByte.cs` - Per-byte metadata structure
	- `Diz.Import/src/bizhawk/BizHawkCdlImporter.cs` - Existing CDL import
	- `Diz.Import/src/mesen/` - Mesen trace log streaming

### Documentation
- Created `~docs/cdl-diz-export-plan.md`:
	- FlagType to CDL flag mapping table
	- CdlExporter class design
	- SimplifiedDizExporter class design
	- UI integration plan
	- Testing strategy
	- Timeline estimates

### Implementation

#### CdlExporter (`Diz.Core/export/CdlExporter.cs`)
- Exports DiztinGUIsh project data to CDL format
- Supports both Mesen (with header) and FCEUX (raw) formats
- Converts FlagType + InOutPoint to CDL flags:
	- Opcode → CDL_Code (0x01)
	- Operand → CDL_Code (0x01)
	- Data types → CDL_Data (0x02)
	- SubEntryPoint → CDL_SubEntryPoint (0x08)
	- JumpTarget → CDL_JumpTarget (0x04)
- Generates file path based on ROM name

#### SimplifiedDizExporter (`Diz.Core/export/SimplifiedDizExporter.cs`)
- Exports simplified JSON for Peony consumption
- Includes labels, comments, and data types
- Supports optional gzip compression
- JSON structure:
	```json
	{
		"ProjectName": "...",
		"RomSize": ...,
		"Labels": { "12345": { "Name": "...", "Comment": "...", "DataType": ... } },
		"DataTypes": [0, 1, 2, ...],
		"Comments": { "12345": "..." }
	}
	```

### Current DiztinGUIsh Capabilities
- **Imports**: BizHawk CDL, Mesen live CDL, CSV labels
- **Exports**: Assembly (.asm), Project files (.diz), **CDL** (new), **SimplifiedDiz** (new)

## FlagType Enum Analysis

DiztinGUIsh uses byte-based FlagType with specific hex values:
```csharp
Unreached = 0x00    // Not logged
Opcode = 0x10       // Instruction start
Operand = 0x11      // Instruction operand
Data8Bit = 0x20     // 8-bit data
Graphics = 0x21     // Graphics/tiles
Music = 0x22        // Audio data
Empty = 0x23        // Empty/filler
Data16Bit = 0x30    // 16-bit data
Pointer16Bit = 0x31 // 16-bit pointer
Data24Bit = 0x40    // 24-bit data
Pointer24Bit = 0x41 // 24-bit pointer
Data32Bit = 0x50    // 32-bit data
Pointer32Bit = 0x51 // 32-bit pointer
Text = 0x60         // Text/string data
```

## Git Commits
- `21e0fed` - feat: Add CDL and SimplifiedDiz exporters for Peony integration

## Build Status
✅ All builds passing

## Next Steps
- Add menu items for export functionality in UI
- Create unit tests for export/import roundtrip
- Test with real project files

## Files Changed
- `~docs/cdl-diz-export-plan.md` (new) - Integration plan
- `Diz.Core/export/CdlExporter.cs` (new) - CDL export
- `Diz.Core/export/SimplifiedDizExporter.cs` (new) - Simplified DIZ export
